@model ITR.Models.TemplateModel
@{
    ViewBag.Title = "FavoriteList";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<ol class="breadcrumb">

    <li>Home</li>
    <li class="active">Create Favourite List</li>

</ol>
<div class="page-heading">
    <h1>Create Favourite List</h1>

    
</div>

<div class="container-fluid">

    <div class="panel">
        <div class="panel-body">
            <div class="row">

                <div class="col-md-3">
                    <label><b>Company :</b></label>

                    <label id="lblCompanyName"></label>
                </div>
                <div class="col-md-3">
                    <label><b>Division :</b></label>

                    <label id="lblDivisionName"></label>
                </div>

            </div>
        </div>
    </div>


    <div class="panel">
        <div class="panel-body">
            <div class="row">


                <div class="col-sm-12">

                    <span style="color:rgba(0, 41, 162, 0.91);" id="spnFavListName"></span>

                    <button class="btn btn-primary-alt" id="ShowFavorites">Show Favorites List</button>
                    <button class="btn btn-info-alt ml-sm" id="HideFavorites">Show All Indicators</button>
                    <button class="btn btn-green-alt ml-sm" id="SaveFavorites">Save Favorites List</button>
                    <button class="btn btn-danger-alt ml-sm" id="ClearFavorites">Clear Favorites</button>
                    <button class="btn btn-brown-alt ml-sm" id="SearchCategory">Search Category</button>

                    <div class="clearfix m-sm"></div>

                    <div id="divIndicator">
                        <!--Here the Indicator list  will be loaded dynamically-->

                        <table class="table table-th-block table-dark link_cursor" id="CorelationLeadLagList">
                            <thead>
                                <tr>

                                    @*<th><input type="checkbox" name="selectAll" value="1" id="selectAll">IndicatoName-Indicator</th>*@
                                    <th>IndicatoName-Indicator</th>
                                    <th>Correlation</th>
                                    <th>Lead/Lag</th>
                                    <th>Company</th>
                                    <th>Indicator</th>
                                    <th>Description</th>
                                    <th>FavouriteListName</th>
                                    <th>Favorites</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>


                </div>
            </div>
        </div>
    </div>

            <!-- Section Added by Raghuveer on July 19 2017 (Start)-->

            <div class="modal2" id="FavListModalPopUp" tabindex="-1" role="dialog" aria-hidden="true" style="display:none;">
                <div class="modal-dialog">
                    <div class="modal-content" style="width:450px">
                        <div class="modal-header">
                            <button id="close" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

                        </div>
                        <div class="modal-body">

                            <div id="dialog-form">
                                <div class="the-box full no-border">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="table-responsive">
                                                <table class="table table-th-block table-dark" id="dtFavList">
                                                    <thead>
                                                        <tr>
                                                            <th>Favorite List Name</th>
                                                            <th>Delete</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody></tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>

                                    <br />

                                    <div class="row btnprint">

                                        <div class="col-sm-4">
                                            <button class="btn btn-warning pull-left" id="btnCancelFavPopUP">Cancel</button>
                                        </div>



                                    </div>

                                </div>



                            </div>


                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /#DefaultModal -->
            </div>



            <div class="modal2" id="SearchCategoryPopup" tabindex="-1" role="dialog" aria-hidden="true" style="display:none;">
                <div class="modal-dialog">
                    <div class="modal-content" style="width:450px">
                        <div class="modal-header">
                            <button id="closecategorypopup" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

                        </div>
                        <div class="modal-body">

                            <div id="dialog-form">
                                <div class="the-box full no-border">
                                    <div class="row">
                                        <div class="col-sm-12">

                                            Category : <select id="ddlCategories" class="form-control link_cursor"></select>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>

                                    <br />
                                    <div class="row" style="display:none" id="subcategoryrow">
                                        <div class="col-sm-12">

                                            Sub Category : <select id="ddlSubCategories" class="form-control link_cursor"></select>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <br />

                                    <div class="row" style="display:none" id="subsector1row">
                                        <div class="col-sm-12">

                                            SubSector1 : <select id="ddlSubSectors1" class="form-control link_cursor"></select>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <br />

                                    <div class="row" style="display:none" id="subsector2row">
                                        <div class="col-sm-12">

                                            SubSector2 : <select id="ddlSubSectors2" class="form-control link_cursor"></select>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <br />

                                    <div class="row" style="display:none" id="subsector3row">
                                        <div class="col-sm-12">

                                            SubSector3 : <select id="ddlSubSectors3" class="form-control link_cursor"></select>
                                        </div>
                                        <!-- /.table-responsive -->
                                    </div>
                                    <br />


                                    <div class="row btnprint">

                                        <div class="col-sm-4">
                                            <button class="btn btn-warning pull-left" id="btnCancelSearchCategoryPopup">Cancel</button>
                                        </div>
                                        <div class="col-sm-4">
                                            <label>&nbsp;</label>
                                        </div>
                                        <div class="col-sm-4">
                                            <button class="btn btn-sucess pull-right" id="btnSearchCategorySubCategory">Search</button>
                                        </div>

                                    </div>

                                </div>



                            </div>


                            <!-- /.modal-content -->
                        </div>
                        <!-- /.modal-content -->
                    </div>
                    <!-- /.modal-dialog -->
                </div>
                <!-- /#DefaultModal -->
            </div>




            <!-- Section Added by Raghuveer on July 19 2017 (End)-->

        </div> <!-- .container-fluid -->
        <!-- Modal Delete -->
        <!-- /end Modal Delete-->
        @if (Session.Count > 0)
        {
            <input type="hidden" id="hdnCompanyID" title="" value="@Session["CompanyID"].ToString()" />
            <input type="hidden" id="hdnDivisionID" title="" value="@Session["DivisonID"].ToString()" />
            <input type="hidden" id="hdnUserID" title="" value="@Session["UserID"].ToString()" />
            <input type="hidden" id="hdnIsDataPortalAdmin" title="" value="@Session["IsDataPortalAdmin"].ToString()" />
            <input type="hidden" id="hdnEmailID" title="" value="@Session["EmailID"].ToString()" />
        }
        else
        {
            <input type="hidden" id="hdnCompanyID" title="" value="" />
            <input type="hidden" id="hdnDivisionID" title="" value="" />
            <input type="hidden" id="hdnUserID" title="" value="" />
            <input type="hidden" id="hdnIsDataPortalAdmin" title="" value="" />
            <input type="hidden" id="hdnEmailID" title="" value="" />
            <script src="~/js/jquery.min.js"></script>
            <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
            <script type="text/javascript" lang="javascript">
                console.log("else case");
                var elseCaseCompanyId = window.localStorage.getItem('ECompanyID');
                $("#hdnCompanyID").val(elseCaseCompanyId);
                var elseCaseDivisionID = window.localStorage.getItem('EDivisionID');
                $("#hdnDivisionID").val(elseCaseDivisionID);
                var elseCaseisDataPortalAdmin = window.localStorage.getItem('EisDataPortalAdmin');
                $("#hdnIsDataPortalAdmin").val(elseCaseisDataPortalAdmin);

                var sessionObj = {
                    CompanyID: window.localStorage.getItem('ECompanyID'),
                    DivisonID: window.localStorage.getItem('EDivisionID'),
                    UserID: window.localStorage.getItem('EUserID'),
                    IsDataPortalAdmin: window.localStorage.getItem('EisDataPortalAdmin'),
                    Value1: window.localStorage.getItem('EUserName'),
                    EmailID :  window.localStorage.getItem('EMailID')

                }
                var itrIISURL = "http://datacast.itreconomics.com/Home/ITRSessionRequest";
                $.ajax({
                    type: "POST",
                    async: false,
                    url: itrIISURL,
                    crossDomain: true,
                    dataType: "json",
                    data: sessionObj,
                    success: function (res) {
                        console.log("Step 4");
                        // console.log(res);
                    },
                    error: function (error) {
                        console.log(error)
                    }
                });

            </script>
        }






        @section PagespecificCss
{
            <link type="text/css" href="../assets/plugins/datatables/dataTables.css" rel="stylesheet">
            <link type="text/css" href="../assets/plugins/datatables/ColReorder/css/dataTables.colReorder.css" rel="stylesheet"> 	<!-- ColReorder -->
            <link type="text/css" href="../assets/plugins/datatables/KeyTable/css/dataTables.keyTable.css" rel="stylesheet"> 		<!-- KeyTable -->
            <link type="text/css" href="../assets/plugins/datatables/dataTables.bootstrap.css" rel="stylesheet"> 					<!-- Bootstrap Support for Datatables -->
            <link type="text/css" href="../assets/plugins/datatables/dataTables.fontAwesome.css" rel="stylesheet"> 					<!-- FontAwesome Support for Datatables -->

            <link href="~/css/jqueryui.css" rel="stylesheet" />
            <link type="text/css" href="../assets/fonts/font-awesome/css/font-awesome.min.css" rel="stylesheet">        <!-- Font Awesome -->
        }
        @section PageSpecificScript
 {

            <script type="text/javascript" src="../assets/plugins/datatables/jquery.dataTables.js"></script>
            <script type="text/javascript" src="../assets/plugins/datatables/dataTables.bootstrap.js"></script>
            <script type="text/javascript" lang="javascript">

                function ajaxindicatorstart() {
                    if ($('body').find('#loadingDiv').attr('id') != 'loadingDiv') {
                        var loadingString = '<div id="loadingDiv" class="modal1"><div id="loading-image" class="center"><img src="../img/home/loader.gif" alt="Loading..." /></div></div>';
                        $('body').append(loadingString);
                        $('#loadingDiv .bg').height('100%');
                        $('#loadingDiv').fadeIn(300);
                        $('body').css('cursor', 'wait');
                    }
                };
                var oTable = "";
                var divisionID = "";
                var isDataPortalAdmin = "",dataSetIDLocal="";
                var _CompanyId = 0;
                var dataSetID = 0;
                var FavList="";
                var FavListFlag = false;
                var FavouriteListName ="",FavListName="";
                var SelFavName = "";
                var CategorySearchStatus="";
                var IndustryName="";
                var SectorName="";
                var SubSector1Name="";
                var SubSector2Name="";
                var SubSector3Name="";

                $(document).ready(function () {

                    _CompanyId = $("#hdnCompanyID").val();//window.localStorage.getItem('CompanyID'); //5916//

                    divisionID = $("#hdnDivisionID").val();//window.localStorage.getItem('DivisionID'); //41//
                    var userID = $("#hdnUserID").val();//window.localStorage.getItem('UserID');
                    isDataPortalAdmin = $("#hdnIsDataPortalAdmin").val(); //true;//

                    //  $("#hdnUserID").val(1);

                    //To Bind the selected values of AddDataset Page if the uer is dataportal admin
                    if ((isDataPortalAdmin == true || isDataPortalAdmin == "true" || isDataPortalAdmin == "TRUE") && window.localStorage.getItem('CompanyID') != null) {
                        _CompanyId = window.localStorage.getItem('ECompanyID');
                        // _CompanyId = 8224;
                        $("#lblCompanyName").html(_CompanyId);
                        LoadDivisions();
                    }
                        // else if (companyID != "" && companyID != "null" && companyID != null) {
                    else if (_CompanyId != "" && _CompanyId != "null" && _CompanyId != null) {
                        $("#lblCompanyName").html(_CompanyId);
                        LoadDivisions();
                    }
                    $("#btnHideFavouriteList").hide();

                    // Section Added By Raghuveer on 7-June-2017
                    // LoadDataSets();
                    LoadIndicatorsList();

                    //Block Started Added by Raghuveer on 6 March 2017
                    var accountsAvailable = @Html.Raw(ViewBag.Accounts);
                    for(var i=0;i<accountsAvailable.length;i++)
                    {
                        if(_CompanyId==accountsAvailable[i].RecordId)
                        {
                            $("#lblCompanyName").html(accountsAvailable[i].AccountName);
                        }
                    }
                    //Block  Ended Added by Raghuveer on 6 March 2017


                    if (divisionID != "" && divisionID != "null" && divisionID != null) {
                        if (isDataPortalAdmin == true || isDataPortalAdmin == "true" || isDataPortalAdmin == "TRUE") { //enable the dropdowns
                        }
                        else if (divisionID != "0" && divisionID != "") {

                        }
                        else {
                        }
                    }
                    else if (divisionID == null) {
                    }



                });

                function LoadDivisions() {
                    var accountid = _CompanyId;//$('#ddlAccounts').val();
                    if (accountid != '' && accountid != '0') {
                        var url = 'GetDivisionsByAccountID/';
                        var modelobj = {
                            id: accountid
                        }
                        $.getJSON(url, modelobj,
                                      function (optionsData) {

                                          $.each(optionsData, function (index, itemData) {
                                              if(itemData.Value== divisionID)
                                              {
                                                  $("#lblDivisionName").html(itemData.Text);
                                              }

                                          });
                                      });


                    }
                    if (isDataPortalAdmin == true || isDataPortalAdmin == "true" || isDataPortalAdmin == "TRUE") {
                        // window.localStorage.setItem('CompanyID', $("#ddlAccounts").val());
                        window.localStorage.setItem('CompanyID', _CompanyId);
                        //   window.localStorage.setItem('DivisionID', 0);
                        window.localStorage.setItem('DivisionID', window.localStorage.getItem('DivisionID'));
                    }
                    else {
                        //   localStorage.clear();
                    }
                }










                //$("#ddlDataSets").on('change', function (e) {
                //    e.preventDefault();
                //    dataSetID = $("#ddlDataSets").val();
                //    dataSetIDLocal= $("#ddlDataSets").val();
                //    $(".spnDataSetName").text($("#ddlDataSets option:selected").text());
                //    ajaxindicatorstart();

                //    $('#ShowFavorites').val(' Show Favorites List ');
                //    $('#SaveFavorites').val(' Save Favorites List ');
                //    FavListFlag = false;
                //    FavList = "";
                //    FavListName = "";
                //    FavListpaginate = "";
                //    SelFavName = "";
                //    $("#spnFavListName").text('');


                //    var oTable = $('#CorelationLeadLagList').dataTable();
                //    oTable.fnDraw();
                //    var bTable = $('#CorelationLeadLagListIndicationSummary').dataTable();
                //    bTable.fnDraw();


                //    var cTable = $('#dtFavList').dataTable();
                //    cTable.fnDraw();
                //    // LoadIndicatorsList();


                //});


                //Loader Implementation stop function
                function ajaxindicatorstop() {
                    $('#loadingDiv .bg').height('100%');
                    $('#loadingDiv').remove();
                    $('body').css('cursor', 'default');
                    // modal-backdrop fade in
                }


                //Check all option
                $('#chkHeader').click(function (e) {

                    if ($('#chkHeader').prop("checked")) {
                        $('.chkChild').each(function () {
                            //$(this).attr('checked', 'checked');
                            $(this).prop('checked', true);
                        });
                    }
                    else {
                        $('input', oTable.fnGetNodes()).removeAttr('checked');
                    }

                });

                $(document).on('click', '#HideFavorites', function (e) {
                    e.preventDefault();

                    FavListFlag = false;
                    //SelFavName = "";
                    //FavList = "";
                    //FavListName = "";
                    //$('#SaveFavorites').val(' Save Favorites List ');

                    var oTable = $('#CorelationLeadLagList').dataTable();
                    oTable.fnDraw();


                });


                $(document).on('click','.LoadFavIndicators',function(e){
                    var FuncnText="";
                    FuncnText = $('#ShowFavorites').val();
                    FavList = "";
                    FavListpaginate = "";
                    SelFavName = "";


                    oTable = $("#dtFavList").dataTable();
                    var aData = oTable.fnGetData($(this).closest('tr'));

                    SelFavName = aData[0];
                    FavListName = SelFavName;
                    $("#spnFavListName").html('Favorite Name: <b>' + FavListName + '</b>');
                    if(FuncnText == " Show Favorites List ")
                    {

                        $('#SaveFavorites').val(' Update Favorites List ');
                        //$('#ShowFavorites').val(' Hide Favorites List ');
                        FavListFlag = true;
                        ////

                        $.getJSON("GetAllFavoritesListByDataSetIDUesrID?dataSetID=Portal&userID=" + $("#hdnUserID").val() + "&SelFavName=" + SelFavName,//need to update userid
              function (data) {
                  var jsonObject = JSON.parse(data);
                  ajaxindicatorstart();

                  for (i = 0; i < jsonObject.length; i++) {
                      var obj = jsonObject[i];

                      //console.log(obj["IndicatorShortCode"]);
                      if(FavList == "")
                          FavList = obj["IndicatorShortCode"]+ ",";
                      else
                      {
                          if(FavList.indexOf(obj["IndicatorShortCode"] + ",") < 0)
                          {
                              FavList = FavList + obj["IndicatorShortCode"] + "," ;
                          }
                      }



                  }
                  var oTable = $('#CorelationLeadLagList').dataTable();
                  oTable.fnDraw();
                  ajaxindicatorstop();

              });







                    }
                    //else
                    //{
                    //    FavListFlag = false;
                    //    $('#SaveFavorites').val(' Save Favorites List ');
                    //    $('#ShowFavorites').val(' Show Favorites List ');
                    //    var oTable = $('#CorelationLeadLagList').dataTable();
                    //    oTable.fnDraw();
                    //}



                    $('#FavListModalPopUp').hide();
                });



                $(document).on('click', '#ShowFavorites', function (e) {
                    e.preventDefault();

                    if($(this).val() == " Show Favorites List ")
                    {
                        var oTablec = $('#dtFavList').dataTable();
                        oTablec.fnDraw();
                        $('#FavListModalPopUp').show();
                    }
                    //else
                    //{
                    //    FavListFlag = false;
                    //    SelFavName = "";
                    //    $('#SaveFavorites').val(' Save Favorites List ');
                    //    $(this).val(' Show Favorites List ');
                    //    var oTable = $('#CorelationLeadLagList').dataTable();
                    //    oTable.fnDraw();
                    //}

                });

                //Save Favorites
                $(document).on('click', '#SaveFavorites', function (e) {
                    e.preventDefault();
                    //    FavList="";
                    $('.CBX').each(function() {

                        if($(this)[0].checked)
                        {
                            if(FavList == "")
                                FavList = $(this).closest('tr').find('td:eq(4)').text() + ",";
                            else
                            {
                                if(FavList.indexOf($(this).closest('tr').find('td:eq(4)').text() + ",") < 0)
                                {
                                    FavList = FavList + $(this).closest('tr').find('td:eq(4)').text() + "," ;
                                }
                            }
                        }
                    });

                    var table = $('#CorelationLeadLagList').DataTable();
                    table.search( '' ).columns().search( '' ).draw();

                    if(FavList != "")
                    {
                        var FavoritesListName = SetFavoritesListName();
                        if (FavoritesListName != null && FavoritesListName != "") {

                            if($(this).val() == " Save Favorites List ")
                            {
                                var url = "AddFavorites";
                            }
                            else
                            {


                                var url = "UpdateFavorites";
                            }
                            var d = new Date();
                            var strDate = d.getFullYear() + "/" + (d.getMonth()+1) + "/" + d.getDate();

                            var modelobj = {
                                CompanyShortCode: "Portal",
                                IndicatorShortCodes: FavList,
                                UserID: $("#hdnUserID").val(),//need to update
                                FavouriteListName: FavoritesListName,
                                CreatedBY : $("#hdnUserID").val(),//need to update
                                CreatedDate:strDate
                            };
                            var response = SendRequestJSON(url, modelobj);

                            if (response.result == 'Success')
                            {
                                if($(this).val() == " Save Favorites List ")
                                {
                                    alert("Favorites added successfully.");

                                }
                                else
                                {
                                    alert("Favorites updated successfully.");
                                    var oTable = $('#CorelationLeadLagList').dataTable();
                                    oTable.fnDraw();
                                    FavListName = FavoritesListName;
                                }

                            }
                        }
                        //else
                        //{
                        //    SetFavoritesListName();
                        //}
                    }
                    else
                    {
                        alert("Please select atleast one Indicator.");
                        return false;
                    }
                });


                function SetFavoritesListName()
                {
                    var FavoritesListName  = "";
                    //  if(FavListFlag == true){
                    FavoritesListName = prompt("Enter Favorites List Name", FavListName);
                    //}
                    //else
                    //    FavoritesListName = prompt("Enter Favorites List Name", '');

                    if (FavoritesListName != null && FavoritesListName != "") {
                        return FavoritesListName;
                    }
                }



                // By Raghuveer on 19 July 2017 (Start)
                function LoadIndicatorsList() {
                    // $(".spnIndicatorName").html('');
                    var oTable ="";
                    ivar = 0;
                    //TABLE DEFINITION for Indicator list
                    oTable = $('#CorelationLeadLagList').dataTable({
                        "aLengthMenu": [[5, 10, 25, 50, 200], [5, 10, 25, 50, 200]],
                        "bScrollCollapse": true,
                        "sType": "POST",
                        "iDisplayLength": 10,
                        "sDom": '<fl><t><ip>r',
                        "bJQueryUI": false,
                        "sPaginationType": "bootstrap",
                        "responsive": true,
                        "oLanguage": {
                            "sProcessing":ajaxindicatorstart(),
                            "sLengthMenu": "_MENU_ records per page",
                            "searchPlaceholder":"search",
                            "oPaginate": {
                                "sPrevious": "Prev",
                                "sNext": "Next"
                            }

                        },
                        // "aaSorting": [[3, 'asc']],
                        "bServerSide": true,
                        "sAjaxSource": "FillCorelationLeadLagByDataSetID",
                        "fnServerParams": function (aoData) {
                            aoData.push({ "name": "dataSetID", "value": "Portal" });
                            aoData.push({ "name": "userID", "value": $("#hdnUserID").val() });//need to update
                            aoData.push({ "name": "IsFavoritesFlag", "value": FavListFlag });
                            aoData.push({ "name": "SelFavName", "value": SelFavName });
                            aoData.push({ "name": "CategorySearch", "value": CategorySearchStatus });
                            aoData.push({ "name": "IndustryName", "value": IndustryName });
                            aoData.push({ "name": "SectorName", "value": SectorName });
                            aoData.push({ "name": "SubSector1Name", "value": SubSector1Name });
                            aoData.push({ "name": "SubSector2Name", "value": SubSector2Name });
                            aoData.push({ "name": "SubSector3Name", "value": SubSector3Name });

                        },
                        "fnDrawCallback": function (oSettings) {

                            //var loopCount=0;
                            $('#CorelationLeadLagList tbody tr:first').each(function () {
                                //if(loopCount==0)
                                //{
                                var _this = this;
                                var aData = "";
                                var nRow = _this;
                                var aData = oTable.fnGetData(nRow); //Get data of current row
                                if (aData == null) {
                                    var tempDataSetID = 0;
                                }
                                else {

                                    var tempDataSetID = aData[0];
                                    companyCode = aData[3];
                                    $(".spnIndicatorName").html(aData[0]);
                                    indicatorShotrCode = aData[4];
                                    //alert(indicatorShotrCode);
                                    //console.log("indicatorShotrCode "+indicatorShotrCode)
                                    //console.log("companyCode "+companyCode)
                                    $(this).addClass("active");
                                    //khaja
                                    ticksRepeatCompany = 0;
                                    ticksRepeatIndicator = 0;
                                    CompanyMaxvalueLine = 0;
                                    IndicatorMaxvalueLine = 0;
                                    CompanyZeroLine = 0;
                                    IndicatorZeroLine = 0;
                                    CompanyZeroLineFlag = false;
                                    IndicatorZeroLineFlag = false;
                                    CompanyNeededLines = 0;
                                    IndicatorNeededLines = 0;
                                    IndicatorMinValueNew = "", IndicatorMaxValueNew = "";
                                    CompanyMinValueNew = "", CompanyMaxValueNew = "";
                                    k = 0;
                                    i = 0;
                                    j = 0;
                                    //IndicatorMinValueFlag = false;



                                    //  ajaxindicatorstop();
                                }
                                //}
                                //loopCount=loopCount+1;


                            })
                        },
                        "bProcessing": true,
                        "aoColumns": [


                                          {
                                              "sName": "IndicatorName-Indicator"
                                          },
                                        {
                                            "sName": "Correlation",
                                            "bSearch": false,
                                            "sClass": "hide_column"
                                        },
                                        {
                                            "sName": "Lead/Lag",
                                            "bSearch": false,
                                            "sClass": "hide_column"
                                        },
                                        { "sName": "Company",
                                            "sClass": "hide_column"
                                        },
                                        {
                                            "sName": "Indicator",
                                            "sClass": "hide_column"
                                        },
                                        {
                                            "sName": "Description",
                                            "bSearch": false,
                                            "sClass": "hide_column"
                                        },
                                        {
                                            "sName": "FavouriteListName",
                                            "bSearch": false,
                                            "sClass": "hide_column",
                                            "render": function (oObj) {
                                                //FavListName = oObj;
                                                return oObj;
                                            }
                                        },
                                        {
                                            "sName": "IndicatorName-Indicator",
                                            "bSearch": false,
                                            "bSortable": false,
                                            "render": function (oObj) {

                                                ivar = ivar + 1;
                                                //if(FavListFlag == false)
                                                // {
                                                if(FavList.indexOf(oObj + ",") >= 0)
                                                {
                                                    return '<input type="checkbox" id='+ ivar + ' class="CBX" checked >';
                                                }
                                                else
                                                    return '<input type="checkbox" id='+ ivar + ' class="CBX" > ';
                                                // }
                                                //else
                                                //   return '<input type="checkbox" id='+ ivar + ' class="CBX" checked >';
                                            }
                                        }


                        ]
                    });
                    //khaja



                    var oTable123 ="";
                    //ivar = 0;
                    //TABLE DEFINITION for Indicator list
                    oTable123 = $('#dtFavList').dataTable({
                        "paging":   false,
                        "ordering": false,
                        "aLengthMenu": [[5, 10, 25, 50, 200], [5, 10, 25, 50, 200]],
                        "bScrollCollapse": true,
                        "sType": "POST",
                        "iDisplayLength": 10,
                        "sDom": '<l><t><ip>r',
                        "bJQueryUI": false,
                        //  "sPaginationType": "bootstrap",
                        "responsive": true,
                        "oLanguage": {
                            "sProcessing":ajaxindicatorstart(),
                            "sLengthMenu": "_MENU_ records per page",
                            "searchPlaceholder":"search",
                            "oPaginate": {
                                "sPrevious": "Prev",
                                "sNext": "Next"
                            }

                        },
                        // "aaSorting": [[3, 'asc']],
                        "bServerSide": true,
                        "sAjaxSource": "FillFavlistNamesByDataSetID",
                        "fnServerParams": function (aoData) {
                            aoData.push({ "name": "dataSetID", "value": dataSetIDLocal });
                            aoData.push({ "name": "userID", "value": $("#hdnUserID").val() });//need to update

                        },

                        "bProcessing": true,
                        "aoColumns": [


                                          {
                                              "sName": "FavouriteListName",
                                              "bSortable":false,
                                              "render": function (oObj) {

                                                  return '<a href="#" class="LoadFavIndicators" title="Click to Load Indicators" >'+  oObj + '</a>';

                                              }
                                          },

                                          {
                                              "sName": "FavouriteListName",
                                              "bSortable":false,
                                              "render": function (oObj) {
                                                  return '<a href="#" data-value='+ oObj +' class="DeleteFavIndicators" title="Click to Load Indicators" >Delete</a>';

                                              }
                                          }


                        ]
                    });


                    //khaja
                    // $('#CorelationLeadLagList_filter input').attr("placeholder", "Search");




                    $("#CorelationLeadLagList_paginate").on("click", "a", function()
                    {
                        $('.CBX').each(function() {
                            if($(this)[0].checked)
                            {
                                if(FavList == "")
                                    FavList = $(this).closest('tr').find('td:eq(4)').text() + ",";
                                else
                                {
                                    if(FavList.indexOf($(this).closest('tr').find('td:eq(4)').text() + ",") < 0)
                                    {
                                        FavList = FavList + $(this).closest('tr').find('td:eq(4)').text() + "," ;
                                    }
                                }


                            }
                            else
                            {
                                if(FavList.indexOf($(this).closest('tr').find('td:eq(4)').text() + ",") >= 0)
                                {
                                    FavList = FavList.replace($(this).closest('tr').find('td:eq(4)').text() + ",","");
                                }
                            }

                        });
                    });

                }


                $(document).on('click', '#btnCancelFavPopUP', function (e) {
                    e.preventDefault();
                    $('#FavListModalPopUp').hide();
                });
                $(document).on('click', '#close', function (e) {
                    e.preventDefault();
                    $('#FavListModalPopUp').hide();
                });
                $(document).keydown(function(e) {
                    // ESCAPE key pressed
                    if (e.keyCode == 27) {
                        $('#FavListModalPopUp').hide();
                    }
                });

                // for tooltip
                $(document).on('mouseover','#CorelationLeadLagList tbody tr',function(e){
                    var ToolTipText = $(this).closest('tr').find('td:eq(5)').text();
                    $(this).attr("title",ToolTipText);
                });

                $(document).on('click', '#ClearFavorites', function (e) {
                    e.preventDefault();

                    $('.CBX').each(function() {
                        if($(this)[0].checked)
                        {
                            $(this)[0].checked = false;
                        }
                    });
                    FavListFlag = false;
                    SelFavName = "";
                    FavList = "";
                    FavListName = "";
                    $('#SaveFavorites').val(' Save Favorites List ');
                    $("#spnFavListName").text('');
                    var oTable = $('#CorelationLeadLagList').dataTable();
                    oTable.fnDraw();

                });


                $(document).on('click','.DeleteFavIndicators',function(e){
                    ajaxindicatorstart();
                    oTable = $("#dtFavList").dataTable();
                    var aData = oTable.fnGetData($(this).closest('tr'));
                    tempFname = aData[0];
                    //	alert(tempFname)
                    var urldelete = "Deletefavourites";
                    var modelobjlocal = {
                        CompanyShortCode: "Portal",
                        UserID : $("#hdnUserID").val(),
                        FavouriteListName: tempFname
                    };

                    var txt;
                    if (confirm("Are you sure?") == true) {
                        var response = SendRequestJSON(urldelete, modelobjlocal);

                        if (response.result == '1')
                        {
                            if(tempFname == FavListName)
                            {

                                FavListFlag = false;
                                SelFavName = "";
                                FavList = "";
                                $("#spnFavListName").text('');

                            }
                            alert("Favorites list deleted successfully.");

                            var oTable1 = $('#CorelationLeadLagList').dataTable();
                            oTable1.fnDraw();
                            var oTable = $('#dtFavList').dataTable();
                            oTable.fnDraw();

                            if(tempFname == FavListName)
                            {

                                $('#SaveFavorites').val(' Save Favorites List ');
                                FavListName = "";
                            }
                            $('#FavListModalPopUp').hide();
                        }
                        else
                        {
                            alert("Unable to Delete Favorite List.");
                        }
                    } else {

                    }


                    ajaxindicatorstop();

                });

                // By Raghuveer on July 19 2017 (End)




                // Section Starts for Datacast 2.3 by Raghuveer


                // By Raghuveer on 29 August 2017 for Datacast 2.3 release
                $(document).on('click', '#SearchCategory', function (e) {
                    e.preventDefault();

                    if($(this).val() == " Search Category ")
                    {
                        var url = 'GetCategoriesForDatacast/';
                        var modelobj = { }
                        $.getJSON(url, modelobj,
                                      function (optionsData) {
                                          var select = $("#ddlCategories");
                                          select.empty();
                                          $("#ddlCategories").append($('<option>', {
                                              value: "Select",
                                              text : "Select"
                                          }));
                                          $.each(optionsData, function (index, itemData) {
                                              select.append($('<option/>', {
                                                  value: itemData.Text,
                                                  text: itemData.Text
                                              }));


                                          });

                                      });

                        $("#ddlCategories").show();

                        $('#SearchCategoryPopup').show();

                    }
                    //else
                    //{
                    //    FavListFlag = false;
                    //    SelFavName = "";
                    //    $('#SaveFavorites').val(' Save Favorites List ');
                    //    $(this).val(' Show Favorites List ');
                    //    var oTable = $('#CorelationLeadLagList').dataTable();
                    //    oTable.fnDraw();
                    //}

                });

                // By Raghuveer on 29 August 2017 for Datacast 2.3 release
                $(document).on('click', '#btnCancelSearchCategoryPopup', function (e) {
                    e.preventDefault();

                    $("#ddlCategories").empty();
                    $("#ddlSubCategories").empty();
                    $("#ddlSubSectors1").empty();
                    $("#ddlSubSectors2").empty();
                    $("#ddlSubSectors3").empty();


                    $("#ddlCategories").hide();


                    $("#subcategoryrow").hide();
                    $("#subsector1row").hide();
                    $("#subsector2row").hide();
                    $("#subsector3row").hide();

                    $('#SearchCategoryPopup').hide();
                });

                // By Raghuveer on 29 August 2017 for Datacast 2.3 release
                $("#ddlCategories").change(function(){



                    $("#ddlSubCategories").empty();
                    $("#ddlSubSectors1").empty();
                    $("#ddlSubSectors2").empty();
                    $("#ddlSubSectors3").empty();

                    $("#subcategoryrow").hide();
                    $("#subsector1row").hide();
                    $("#subsector2row").hide();
                    $("#subsector3row").hide();


                    var url = 'GetSubCategoriesbyCategory/';
                    var modelobj = {
                        Industry : $(this).val()
                    }
                    $.getJSON(url, modelobj,
                                  function (optionsData) {
                                      var select = $("#ddlSubCategories");
                                      select.empty();
                                      select.append($('<option/>',{value: "Select",
                                          text : "Select"
                                      }));
                                      $.each(optionsData, function (index, itemData) {
                                          select.append($('<option/>', {
                                              value: itemData.Text,
                                              text: itemData.Text
                                          }));
                                      });


                                      if(optionsData.length>0 )
                                      {
                                          $("#subcategoryrow").show();

                                      }
                                  });
                });

                // By Raghuveer on 29 August 2017 for Datacast 2.3 release
                $("#ddlSubCategories").change(function(){

                    $("#ddlSubSectors1").empty();
                    $("#ddlSubSectors2").empty();
                    $("#ddlSubSectors3").empty();

                    $("#subsector1row").hide();
                    $("#subsector2row").hide();
                    $("#subsector3row").hide();

                    var url = 'GetSubSectors1BySector/';
                    var modelobj = {
                        Industry : $("#ddlCategories").val(),
                        Sector : $(this).val(),
                    }
                    $.getJSON(url, modelobj,
                                  function (optionsData) {
                                      var select = $("#ddlSubSectors1");
                                      select.empty();
                                      select.append($('<option/>',{value: "Select",
                                          text : "Select"
                                      }));
                                      $.each(optionsData, function (index, itemData) {
                                          select.append($('<option/>', {
                                              value: itemData.Text,
                                              text: itemData.Text
                                          }));


                                      });
                                      if(optionsData.length>0 )
                                          $("#subsector1row").show();
                                  });


                });

                // By Raghuveer on 29 August 2017 for Datacast 2.3 release
                $("#ddlSubSectors1").change(function(){

                    $("#ddlSubSectors2").empty();
                    $("#ddlSubSectors3").empty();

                    $("#subsector2row").hide();
                    $("#subsector3row").hide();

                    var url = 'GetSubSectors2BySubSectors1/';
                    var modelobj = {
                        Industry : $("#ddlCategories").val(),
                        Sector : $("#ddlSubCategories").val(),
                        SubSector1 : $(this).val()
                    }
                    $.getJSON(url, modelobj,
                                  function (optionsData) {
                                      var select = $("#ddlSubSectors2");
                                      select.empty();
                                      select.append($('<option/>',{value: "Select",
                                          text : "Select"
                                      }));
                                      $.each(optionsData, function (index, itemData) {
                                          select.append($('<option/>', {
                                              value: itemData.Text,
                                              text: itemData.Text
                                          }));


                                      });
                                      if(optionsData.length>0 )
                                          $("#subsector2row").show();
                                  });


                });

                // By Raghuveer on 29 August 2017 for Datacast 2.3 release
                $("#ddlSubSectors2").change(function(){

                    $("#ddlSubSectors3").empty();
                    $("#subsector3row").hide();

                    var url = 'GetSubSectors3BySubSectors2/';
                    var modelobj = {
                        Industry : $("#ddlCategories").val(),
                        Sector : $("#ddlSubCategories").val(),
                        SubSector1 : $("#ddlSubSectors1").val(),
                        SubSector2 : $(this).val()
                    }
                    $.getJSON(url, modelobj,
                                  function (optionsData) {
                                      var select = $("#ddlSubSectors3");
                                      select.empty();
                                      select.append($('<option/>',{value: "Select",
                                          text : "Select"
                                      }));
                                      $.each(optionsData, function (index, itemData) {
                                          select.append($('<option/>', {
                                              value: itemData.Text,
                                              text: itemData.Text
                                          }));


                                      });
                                      if(optionsData.length>0 )
                                          $("#subsector3row").show();
                                  });



                });

                $(document).on('click', '#closecategorypopup', function (e) {
                    e.preventDefault();
                    $("#ddlCategories").empty();
                    $("#ddlSubCategories").empty();
                    $("#ddlSubSectors1").empty();
                    $("#ddlSubSectors2").empty();
                    $("#ddlSubSectors3").empty();


                    $("#ddlCategories").hide();


                    $("#subcategoryrow").hide();
                    $("#subsector1row").hide();
                    $("#subsector2row").hide();
                    $("#subsector3row").hide();

                    $('#SearchCategoryPopup').hide();
                });




                $("#btnSearchCategorySubCategory").click(function()
                {
                    CategorySearchStatus = "CategorySearch";
                    IndustryName = $("#ddlCategories").val();
                    SectorName = $("#ddlSubCategories").val();
                    SubSector1Name = $("#ddlSubSectors1").val();
                    SubSector2Name = $("#ddlSubSectors2").val();
                    SubSector3Name = $("#ddlSubSectors3").val();
                    FavListFlag = true;
                    var oTable = $('#CorelationLeadLagList').dataTable();
                    oTable.fnDraw();
                    $("#btnCancelSearchCategoryPopup").click();

                });
                // Section Ends for Datacast 2.3 By Raghuveer




            </script>
            <style>
                .modal2 {
                    position: fixed;
                    z-index: 999;
                    background-color: transparent;
                    filter: alpha(opacity=60);
                    top: 20%;
                    left: 33%;
                    opacity: 2;
                    -moz-opacity: 0.8;
                }
            </style>
        }
